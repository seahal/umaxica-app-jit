# Omakase Ruby styling for Rails
inherit_gem:
  rubocop-rails-omakase: rubocop.yml

plugins:
  - rubocop-i18n
  - rubocop-rake
  - rubocop-rubycw
  - rubocop-minitest
  - rubocop-performance
  - rubocop-thread_safety

# .rubocop.yml
AllCops:
  # Target Ruby version
  TargetRubyVersion: 4.0
  # Enable caching
  UseCache: true
  # Specify where to store cached results
  CacheRootDirectory: tmp/rubocop_cache
  # Enable new cops by default
  NewCops: enable
  #
  Exclude:
    - 'vendor/**/*'
    - 'node_modules/**/*'
    - 'db/schema.rb'
    - 'bin/**/*'
    - 'tmp/**/*'
  Include:
    - '**/*.rb'
    - '**/*.rake'
    - '**/Gemfile'
    - '**/Rakefile'

Rails:
  Enabled: true
Security:
  Enabled: true
Security/CompoundHash: # new in 1.28
  Enabled: true
Security/IoMethods: # new in 1.22
  Enabled: true
Rails/ActionControllerFlashBeforeRender: # new in 2.16
  Enabled: true
Rails/ActionControllerTestCase: # new in 2.14
  Enabled: true
Rails/ActionOrder: # new in 2.17
  Enabled: true
Rails/ActiveRecordCallbacksOrder: # new in 2.7
  Enabled: true
Rails/ActiveSupportOnLoad: # new in 2.16
  Enabled: true
Rails/AddColumnIndex: # new in 2.11
  Enabled: true
Rails/AfterCommitOverride: # new in 2.8
  Enabled: true
Rails/AttributeDefaultBlockValue: # new in 2.9
  Enabled: true
Rails/CompactBlank: # new in 2.13
  Enabled: true
Rails/DangerousColumnNames: # new in 2.21
  Enabled: true
Rails/DeprecatedActiveModelErrorsMethods: # new in 2.14
  Enabled: true
Rails/DotSeparatedKeys: # new in 2.15
  Enabled: true
Rails/DuplicateAssociation: # new in 2.14
  Enabled: true
Rails/DuplicateScope: # new in 2.14
  Enabled: true
Rails/DurationArithmetic: # new in 2.13
  Enabled: true
Rails/EagerEvaluationLogMessage: # new in 2.11
  Enabled: true
Rails/EnumSyntax: # new in 2.26
  Enabled: true
Rails/EnvLocal: # new in 2.22
  Enabled: true
Rails/ExpandedDateRange: # new in 2.11
  Enabled: true
Rails/FindById: # new in 2.7
  Enabled: true
Rails/FreezeTime: # new in 2.16
  Enabled: true
Rails/I18nLazyLookup: # new in 2.14
  Enabled: true
Rails/I18nLocaleAssignment: # new in 2.11
  Enabled: true
Rails/I18nLocaleTexts: # new in 2.14
  Enabled: true
Rails/IgnoredColumnsAssignment: # new in 2.17
  Enabled: true
Rails/Inquiry: # new in 2.7
  Enabled: true
Rails/MailerName: # new in 2.7
  Enabled: true
Rails/MatchRoute: # new in 2.7
  Enabled: true
Rails/MigrationClassName: # new in 2.14
  Enabled: true
Rails/MultipleRoutePaths: # new in 2.29
  Enabled: true
Rails/NegateInclude: # new in 2.7
  Enabled: true
Rails/Pluck: # new in 2.7
  Enabled: true
Rails/PluckInWhere: # new in 2.7
  Enabled: true
Rails/RedundantActiveRecordAllMethod: # new in 2.21
  Enabled: true
Rails/RedundantPresenceValidationOnBelongsTo: # new in 2.13
  Enabled: true
Rails/RedundantTravelBack: # new in 2.12
  Enabled: true
Rails/RenderInline: # new in 2.7
  Enabled: true
Rails/RenderPlainText: # new in 2.7
  Enabled: true
Rails/ResponseParsedBody: # new in 2.18
  Enabled: true
Rails/RootJoinChain: # new in 2.13
  Enabled: true
Rails/RootPathnameMethods: # new in 2.16
  Enabled: true
Rails/RootPublicPath: # new in 2.15
  Enabled: true
Rails/ShortI18n: # new in 2.7
  Enabled: true
Rails/SquishedSQLHeredocs: # new in 2.8
  Enabled: true
Rails/StripHeredoc: # new in 2.15
  Enabled: true
Rails/StrongParametersExpect: # new in 2.29
  Enabled: true
Rails/ThreeStateBooleanColumn: # new in 2.19
  Enabled: true
Rails/TimeZoneAssignment: # new in 2.10
  Enabled: true
Rails/ToFormattedS: # new in 2.15
  Enabled: true
Rails/ToSWithArgument: # new in 2.16
  Enabled: true
Rails/TopLevelHashWithIndifferentAccess: # new in 2.16
  Enabled: true
Rails/TransactionExitStatement: # new in 2.14
  Enabled: true
Rails/UnusedRenderContent: # new in 2.21
  Enabled: true
Rails/WhereEquals: # new in 2.9
  Enabled: true
Rails/WhereExists: # new in 2.7
  Enabled: true
Rails/WhereMissing: # new in 2.16
  Enabled: true
Rails/WhereNot: # new in 2.8
  Enabled: true
Rails/WhereNotWithMultipleConditions: # new in 2.17
  Enabled: true
Rails/WhereRange: # new in 2.25
  Enabled: true
Rails/FindByOrAssignmentMemoization: # new in 2.33
  Enabled: true
Rails/OrderArguments: # new in 2.33
  Enabled: true
Style/AsciiComments:
  Enabled: true
Layout/IndentationWidth:
  Width: 2
Style/Documentation:
  Enabled: false

# ============================================================
# Performance Cops（パフォーマンス最適化）
# ============================================================
Performance:
  Enabled: true

Performance/AncestorsInclude:
  Enabled: true
Performance/BigDecimalWithNumericArgument:
  Enabled: true
Performance/BlockGivenWithExplicitBlock:
  Enabled: true
Performance/CollectionLiteralInLoop:
  Enabled: true
Performance/ConcurrentMonotonicTime:
  Enabled: true
Performance/ConstantRegexp:
  Enabled: true
Performance/MapCompact:
  Enabled: true
Performance/MethodObjectAsBlock:
  Enabled: true
Performance/RedundantEqualityComparisonBlock:
  Enabled: true
Performance/RedundantSplitRegexpArgument:
  Enabled: true
Performance/StringIdentifierArgument:
  Enabled: true
Performance/Sum:
  Enabled: true

# ============================================================
# Metrics（コード複雑度・サイズ制限）
# ============================================================
Metrics/AbcSize:
  Max: 30  # デフォルト: 17
  Exclude:
    - 'db/**/*_migrate/**/*'
    - 'test/**/*'

Metrics/BlockLength:
  Max: 50
  Exclude:
    - 'config/**/*'
    - 'db/**/*_migrate/**/*'
    - 'test/**/*'

Metrics/ClassLength:
  Max: 200
  Exclude:
    - 'test/**/*'

Metrics/CyclomaticComplexity:
  Max: 10  # デフォルト: 7

Metrics/MethodLength:
  Max: 25  # デフォルト: 10
  Exclude:
    - 'db/**/*_migrate/**/*'
    - 'test/**/*'

Metrics/ModuleLength:
  Max: 200

Metrics/ParameterLists:
  Max: 5
  MaxOptionalParameters: 3

Metrics/PerceivedComplexity:
  Max: 10

# ============================================================
# Lint（潜在的なバグの検出）
# ============================================================
Lint/AmbiguousAssignment:
  Enabled: true
Lint/AmbiguousOperatorPrecedence:
  Enabled: true
Lint/AmbiguousRange:
  Enabled: true
Lint/DeprecatedConstants:
  Enabled: true
Lint/DuplicateBranch:
  Enabled: true
Lint/DuplicateRegexpCharacterClassElement:
  Enabled: true
Lint/EmptyBlock:
  Enabled: false
Lint/EmptyClass:
  Enabled: false
Lint/IncompatibleIoSelectWithFiberScheduler:
  Enabled: true
Lint/LambdaWithoutLiteralBlock:
  Enabled: true
Lint/NoReturnInBeginEndBlocks:
  Enabled: true
Lint/NumberedParameterAssignment:
  Enabled: true
Lint/OrAssignmentToConstant:
  Enabled: true
Lint/RedundantDirGlobSort:
  Enabled: true
Lint/RequireRelativeSelfPath:
  Enabled: true
Lint/SymbolConversion:
  Enabled: true
Lint/ToEnumArguments:
  Enabled: true
Lint/TripleQuotes:
  Enabled: true
Lint/UnexpectedBlockArity:
  Enabled: true
Lint/UnmodifiedReduceAccumulator:
  Enabled: true
Lint/UselessRuby2Keywords:
  Enabled: true

# ============================================================
# Security（セキュリティ強化）
# ============================================================
Security/Eval:
  Enabled: true
Security/JSONLoad:
  Enabled: true
Security/MarshalLoad:
  Enabled: true
Security/Open:
  Enabled: true
Security/YAMLLoad:
  Enabled: true

# ============================================================
# Style（コーディングスタイル）
# ============================================================
Style/ArgumentsForwarding:
  Enabled: true
Style/CollectionCompact:
  Enabled: true
Style/DocumentDynamicEvalDefinition:
  Enabled: true
Style/EndlessMethod:
  Enabled: true
Style/HashConversion:
  Enabled: true
Style/HashExcept:
  Enabled: true
Style/IfWithBooleanLiteralBranches:
  Enabled: true
Style/InPatternThen:
  Enabled: true
Style/MultilineInPatternThen:
  Enabled: true
Style/NilLambda:
  Enabled: true
Style/NumberedParameters:
  Enabled: true
Style/NumberedParametersLimit:
  Enabled: true
Style/QuotedSymbols:
  Enabled: true
Style/RedundantArgument:
  Enabled: true
Style/RedundantSelfAssignmentBranch:
  Enabled: true
Style/SelectByRegexp:
  Enabled: true
Style/StringChars:
  Enabled: true
Style/SwapValues:
  Enabled: true

# ============================================================
# Layout（レイアウト・フォーマット）
# ============================================================
Layout/LineLength:
  Max: 120
  Exclude:
    - 'config/**/*'
    - 'db/**/*_migrate/**/*'

Layout/SpaceBeforeBrackets:
  Enabled: true
Layout/LineEndStringConcatenationIndentation:
  Enabled: true

# ============================================================
# Naming（命名規則）
# ============================================================
Naming/BlockForwarding:
  Enabled: true
Naming/InclusiveLanguage:
  Enabled: true
  FlaggedTerms:
    whitelist:
      Suggestions:
        - allowlist
        - permitted
    blacklist:
      Suggestions:
        - denylist
        - blocked

# ============================================================
# Minitest（テストコード品質）
# ============================================================
Minitest:
  Enabled: true

# アサーションの適切な使用
Minitest/AssertEmpty:
  Enabled: true
Minitest/AssertEqual:
  Enabled: true
Minitest/AssertIncludes:
  Enabled: true
Minitest/AssertInstanceOf:
  Enabled: true
Minitest/AssertKindOf:
  Enabled: true
Minitest/AssertMatch:
  Enabled: true
Minitest/AssertNil:
  Enabled: true
Minitest/AssertOperator:
  Enabled: true
Minitest/AssertPathExists:
  Enabled: true
Minitest/AssertPredicate:
  Enabled: true
Minitest/AssertRespondTo:
  Enabled: true
Minitest/AssertSame:
  Enabled: true
Minitest/AssertTruthy:
  Enabled: true
Minitest/AssertWithExpectedArgument:
  Enabled: true

# Refuteアサーションの適切な使用
Minitest/RefuteEmpty:
  Enabled: true
Minitest/RefuteEqual:
  Enabled: true
Minitest/RefuteFalse:
  Enabled: true
Minitest/RefuteIncludes:
  Enabled: true
Minitest/RefuteInstanceOf:
  Enabled: true
Minitest/RefuteKindOf:
  Enabled: true
Minitest/RefuteMatch:
  Enabled: true
Minitest/RefuteNil:
  Enabled: true
Minitest/RefuteOperator:
  Enabled: true
Minitest/RefutePathExists:
  Enabled: true
Minitest/RefutePredicate:
  Enabled: true
Minitest/RefuteRespondTo:
  Enabled: true
Minitest/RefuteSame:
  Enabled: true

# テストの品質向上
Minitest/AssertionInLifecycleHook:
  Enabled: true
Minitest/DuplicateTestRun:
  Enabled: true
Minitest/EmptyLineBeforeAssertionMethods:
  Enabled: false  # スタイルの好みによる
Minitest/Focus:
  Enabled: true  # focus: true を検出（本番環境でのフォーカステスト防止）
Minitest/GlobalExpectations:
  Enabled: false  # グローバルな期待値は許可（Rails標準）
Minitest/LifecycleHooksOrder:
  Enabled: true
Minitest/LiteralAsActualArgument:
  Enabled: true
Minitest/MultipleAssertions:
  Enabled: false  # 複数のアサーションは許可
Minitest/NoAssertions:
  Enabled: false  # アサーションのないテストを検出（開発中は無効化）
Minitest/NoTestCases:
  Enabled: false  # テストケースのないクラスを検出（プレースホルダーを許可）
Minitest/NonExecutableTestMethod:
  Enabled: true
Minitest/NonPublicTestMethod:
  Enabled: true
Minitest/RedundantMessageArgument:
  Enabled: true
Minitest/ReturnInTestMethod:
  Enabled: true
Minitest/SkipEnsure:
  Enabled: true
Minitest/SkipWithoutReason:
  Enabled: false  # スキップ理由は推奨だが必須ではない
Minitest/TestFileName:
  Enabled: true
Minitest/TestMethodName:
  Enabled: true
Minitest/UnreachableAssertion:
  Enabled: true
Minitest/UnspecifiedException:
  Enabled: true
Minitest/UselessAssertion:
  Enabled: true

# ============================================================
# Rake（Rakeタスク品質）
# ============================================================
Rake:
  Enabled: true

Rake/ClassDefinitionInTask:
  Enabled: true  # タスク内でのクラス定義を検出
Rake/Desc:
  Enabled: true  # 公開タスクには説明（desc）が必要
Rake/DuplicateNamespace:
  Enabled: true  # 重複した名前空間を検出
Rake/DuplicateTask:
  Enabled: true  # 重複したタスクを検出
Rake/MethodDefinitionInTask:
  Enabled: true  # タスク内でのメソッド定義を検出


# You *must* choose GetText or Rails-i18n style checking
# If you want rails-i18n-style checking
I18n/RailsI18n:
  Enabled: true
I18n/GetText:
  Enabled: false