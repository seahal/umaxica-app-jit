<%= turbo_frame_tag "document_detail" do %>
  <article class="bg-white shadow-lg rounded-lg overflow-hidden">
    <!-- Document Header -->
    <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6">
      <div class="flex justify-between items-start">
        <div class="flex-1">
          <h1 class="text-3xl font-bold mb-2">
            <% begin %>
              <%= @version.title %>
            <% rescue ActiveRecord::Encryption::Errors::Decryption %>
              <%= @document.permalink %>
            <% end %>
          </h1>

          <% begin %>
            <% if @version.description.present? %>
              <p class="text-blue-100 mb-3">
                <%= @version.description %>
              </p>
            <% end %>
          <% rescue ActiveRecord::Encryption::Errors::Decryption %>
          <% end %>

          <div class="flex gap-3 text-xs text-blue-100">
            <span>
              <code class="bg-blue-700 px-2 py-1 rounded"><%= @document.permalink %></code>
            </span>
            <% if @document.published_at %>
              <span>
                <%= @document.published_at.strftime("%Y-%m-%d") %>
              </span>
            <% end %>
          </div>
        </div>

        <div class="ml-4">
          <% if @document.status_id == "ACTIVE" %>
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-white text-green-600">
              Active
            </span>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Document Content -->
    <div class="p-6">
      <% begin %>
        <% if @version.body.present? %>
          <div class="prose max-w-none">
            <%= simple_format(@version.body, {}, sanitize: true) %>
          </div>
        <% else %>
          <p class="text-gray-500 italic">No content available.</p>
        <% end %>
      <% rescue ActiveRecord::Encryption::Errors::Decryption %>
        <p class="text-gray-500 italic">Content unavailable (encryption error).</p>
      <% end %>
    </div>

    <!-- Document Meta Information -->
    <div class="border-t border-gray-200 bg-gray-50 p-4">
      <div class="grid grid-cols-2 gap-3 text-xs">
        <div>
          <strong class="text-gray-700">Document ID:</strong>
          <div class="text-gray-600 font-mono text-xs mt-1"><%= @document.id %></div>
        </div>

        <div>
          <strong class="text-gray-700">Response Mode:</strong>
          <div class="text-gray-600 mt-1"><%= @document.response_mode.upcase %></div>
        </div>

        <div>
          <strong class="text-gray-700">Last Updated:</strong>
          <div class="text-gray-600 mt-1">
            <%= @version.created_at.strftime("%Y-%m-%d %H:%M") %>
          </div>
        </div>

        <% if @document.expires_at && @document.expires_at < 100.years.from_now %>
          <div>
            <strong class="text-gray-700">Expires:</strong>
            <div class="text-gray-600 mt-1">
              <%= @document.expires_at.strftime("%Y-%m-%d") %>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Version History -->
    <div class="border-t border-gray-200 p-4">
      <h3 class="text-sm font-bold mb-3">Recent Versions</h3>

      <div class="space-y-2">
        <% @document.com_document_versions.order(created_at: :desc).limit(5).each_with_index do |version, index| %>
          <div class="flex items-center gap-3 p-2 <%= index == 0 ? 'bg-blue-50 border-l-2 border-blue-500' : 'bg-gray-50' %> rounded text-xs">
            <div class="flex-shrink-0">
              <% if index == 0 %>
                <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-blue-500 text-white text-xs font-bold">
                  ●
                </span>
              <% else %>
                <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-gray-300 text-gray-600 text-xs">
                  <%= @document.com_document_versions.count - index %>
                </span>
              <% end %>
            </div>

            <div class="flex-1">
              <div class="font-medium text-gray-900">
                <% begin %>
                  <%= version.title || "Untitled" %>
                <% rescue ActiveRecord::Encryption::Errors::Decryption %>
                  Untitled
                <% end %>
              </div>
              <div class="text-gray-600">
                <%= version.created_at.strftime("%Y-%m-%d %H:%M") %>
                <% if version.edited_by_type.present? %>
                  · <%= version.edited_by_type %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <% if @document.com_document_versions.count > 5 %>
        <div class="mt-3 text-center text-xs text-gray-600">
          <%= @document.com_document_versions.count - 5 %> more versions
        </div>
      <% end %>
    </div>
  </article>
<% end %>
