pre-commit:
  parallel: true
  commands:
    bun_audit:
      run: |
        #!/bin/sh
        set -eu
        if [ -f /.dockerenv ]; then
          bun audit
        else
          docker compose run core bun audit
        fi
    bun_biome_check:
      run: |
        #!/bin/sh
        set -eu
        if [ -f /.dockerenv ]; then
          bun run check
        else
          docker compose run core bun check
        fi
    bun_type_check:
      run: |
        #!/bin/sh
        set -eu
        if [ -f /.dockerenv ]; then
          bun run type
        else
          docker compose run core bun type
        fi
    ruby_rubocop:
      run: |
        #!/bin/sh
        set -eu
        if [ -f /.dockerenv ]; then
          bundle exec rubocop
        else
          docker compose run core bundle exec rubocop
        fi
    ruby_erb_lint:
      run: |
        #!/bin/sh
        set -eu
        if [ -f /.dockerenv ]; then
          bundle exec erb_lint -a .
        else
          docker compose run core bundle exec erb_lint -a .
        fi
    ruby_audit:
      run: |
        #!/bin/sh
        set -eu
        if [ -f /.dockerenv ]; then
          bundle exec bundler-audit check --update
        else
          docker compose run core bundle exec bundler-audit check --update
        fi
    ruby_brakeman:
      run: |
        #!/bin/sh
        set -eu
        if [ -f /.dockerenv ]; then
          bundle exec brakeman --no-pager
        else
          docker compose run core bundle exec brakeman --no-pager
        fi
    ruby_on_rails_test:
      run: |
        #!/bin/sh
        set -eu
        if [ -f /.dockerenv ]; then
          bundle exec rails db:migrate && bundle exec rails test
        else
          docker compose run core bash -c "bundle exec rails db:migrate && bundle exec rails test "
        fi
    # secret-scan:
    #   run: |
    #     #!/bin/sh
    #     set -eu
    #     docker run -v pwd:pwd -w pwd --rm -it secretlint/secretlint secretlint "**/*"
    # # secret-scan:
    #   run: gitleaks protect
